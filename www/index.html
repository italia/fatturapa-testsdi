<!DOCTYPE html>
<html lang="it">
  <head>
    <meta charset="UTF-8">
    <title>FatturaPA testUI</title>
    <script type="text/javascript" src="js/vue.min.js"></script>
  </head>
  <body>
    <h2>FatturaPA testUI</h2>
    <a href="https://github.com/simevo/fatturapa-testui">https://github.com/simevo/fatturapa-testui</a>
    <hr/>

    <div id="tables">
      <invoice-table endpoint="/sdi/rpc/invoices/?status=E_RECEIVED" title="Ricevute"></invoice-table>
      <invoice-table endpoint="/sdi/rpc/invoices/?status=E_VALID" title="Valide"></invoice-table>
      <invoice-table endpoint="/sdi/rpc/invoices/?status=E_FAILED_DELIVERY" title="Mancata consegna"></invoice-table>
      <invoice-table endpoint="/sdi/rpc/invoices/?status=E_DELIVERED" title="Consegnate"></invoice-table>
      <invoice-table endpoint="/sdi/rpc/invoices/?status=E_INVALID" title="Invalide"></invoice-table>
      <invoice-table endpoint="/sdi/rpc/invoices/?status=E_IMPOSSIBLE_DELIVERY" title="Consegna impossibile"></invoice-table>
      <invoice-table endpoint="/sdi/rpc/invoices/?status=E_ACCEPTED" title="Accettate"></invoice-table>
      <invoice-table endpoint="/sdi/rpc/invoices/?status=E_REFUSED" title="Rifiutate"></invoice-table>
      <invoice-table endpoint="/sdi/rpc/invoices/?status=E_EXPIRED" title="Termini scaduti"></invoice-table>
    </div>

    <script type="text/javascript">
    // configuration for jshint
    /* jshint browser: true, devel: true */
    /* global Vue, Handlebars, jsonSchema */
    
    "use strict";
    
    Vue.component('invoice-table', {
      props: ['endpoint', 'title'],
      data: function () {
        return {
          invoices: []
        }
      },
      mounted: function () {
        var self = this;
        var request = new XMLHttpRequest();
        request.open("GET", self.endpoint);
        request.onload = function() {
            if (request.status == 200) {
                if (request.responseText) {
                    var invoices = JSON.parse(request.responseText);
                    self.invoices = invoices;
                }
            }
        };
        request.send();
      },
      template: '\
        <div>\
          <h3>{{ title }}</h3>\
          <table>\
            <tr><th>Id</th><th>Da</th><th>A</th></tr>\
            <tr v-for="i in invoices">\
                <td>{{ i.id }}</td>\
                <td>{{ i.source }}</td>\
                <td>{{ i.destination }}</td>\
            </tr>\
          </table>\
        </div>'
    });

    var app = new Vue({
      el: '#tables'
    });
    
    document.addEventListener('DOMContentLoaded', function() {
      console.log("DOM fully loaded and parsed");
    });
</script>    
  </body>
</html>
